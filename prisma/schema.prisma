generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  cpf       String   @unique

  // ðŸ”¹ Campos adicionais para melhorar match quality no Meta e identificaÃ§Ã£o de usuÃ¡rio
  email     String?  @unique        // email do usuÃ¡rio (hashado no CAPI)
  phone     String?                  // telefone com DDI, ex: 5599999999999
  firstName String?                  // primeiro nome
  lastName  String?                  // sobrenome
  city      String?                  // cidade (para user_data do Meta)
  state     String?                  // estado (UF)
  zip       String?                  // CEP
  country   String?  @default("BR")  // paÃ­s (BR por padrÃ£o)

  createdAt DateTime @default(now())
  orders    Order[]
}

model Order {
  id        String   @id @default(uuid())
  userId    String
  amount    Float
  quantity  Int      @default(0)          // ðŸ‘ˆ NOVO CAMPO: qtd total de nÃºmeros
  status    String   @default("pending")  // pending, paid, canceled
  createdAt DateTime @default(now())

  // ðŸ”¹ Campo para integraÃ§Ã£o com Meta CAPI
  // Usado como event_id para deduplicaÃ§Ã£o entre browser e servidor
  metaEventId String?                   // event_id usado no Meta (CAPI / Pixel)

  user         User          @relation(fields: [userId], references: [id])
  transactions Transaction[]
  tickets      Ticket[]

  @@index([userId])
  @@index([status])
}

model Transaction {
  id        String   @id @default(uuid())
  orderId   String
  value     Float
  status    String   @default("pending") // pending, paid, failed
  gatewayId String?                      // ID retornado pelo gateway

  // ðŸ‘‡ mapeando exatamente para a coluna fÃ­sica "pixcopiacola"
  pixCopiaCola String? @map("pixcopiacola") // cÃ³digo PIX copia e cola

  createdAt DateTime @default(now())
  order     Order    @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@index([status])
}

model Ticket {
  id        String   @id @default(uuid())
  orderId   String
  number    Int
  createdAt DateTime @default(now())
  order     Order    @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@index([number])
}
